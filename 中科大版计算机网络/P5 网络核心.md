P5 网络核心

网络核心主要的作用，是数据交换，源主机发出去，成功传入目标主机。

基本问题：数据怎样通过网络进行传输

电路交换1：线路交换
打电话之前需要建立用户之间的连接。
端到端的资源被分配给从源端到目标端的呼叫Call。两个主机通信之前，建立一个独享的线路。一个节点到另一个节点之间的路径分为了多个piece。各挑一个空闲的piece，就可以构建成一个线路。这是独享资源。电话都拨通了，即使没说话，也要收钱，因为你占用了独享的线路资源。没有人跟你抢，从而保障了性能，如果共享的话，就没有保障。资源的独享和性能保障是关联的。虽然共享可以采用某个机制来保证性能。

计算机和计算机的通信，不是持续发生，只浏览网站时，不会发生流量抖动，因此采用线路交换（即，电路交换）的时候，可能不太合适。


1. 先讨论一下将带宽分成片（piece），频分，时分，波分（光通信）。
频分FDM：交换节点之间链路，带宽比较宽，有效
时分TDM：将两个节点的通信能力，大致分为一个周期，每个周期划为多少片，分给一定的用户。
波分WDM：采用光链路，节点之间可用的波段可以分为若干个小波段，每个用户使用其中的一个小波段。
CDM：主要用于接入的方式，3G
2.在看一个例题两个节点（A，B）之间，通信链路的带宽，是1.536M bps
采用时分多路复用，分为24个时隙（slot），每个用户使用一个时隙。每个用户可以获得，1.536M / 24 = 64 K bps
进行一次行为，先建立连接，花费时间，然后进行时分多路复用进行传，花费时间，但是发送完之后也不一定能受到，因为还会收到传播延迟（电磁波信号穿越空间的代价，根据物理距离远近可以选择是否可以忽略不计）的影响。

线路交换为什么不适合计算机之间的通信：

连接建立时间长（秒级）
计算机之间的通信具有突发性，如果使用线路交换，则浪费的片比较多。即使这个呼叫没有数据传递，其所占据的片也不能被别的呼叫使用。
可靠性不高？如果最核心的节点损毁，那么会影响深远。

网络核心2：分组交换

节点之间通信链路（每一跳）都是用全部，而不是piece
主机到主机的数据，进行一个分组packet。以packet为单位（包）越过每个通信链路时，进行一个存储转发，存储转发的方式。

为什么存下来再转？A到B数据中如果没有存储转发，假设经过两跳。10G，则直长过去，一直占据的所有线路，变成了独享。而存储转发，当使用第一个链路时，其他链路也可以被别的传输而使用。有数据占用网络资源，没有数据就不占用资源。

线路交换，每个交换节点，只耽误一个比特的时间，但是分组交换，在每个交换节点，要占一个分组的时间。还有要有一个节点的排队时延。因为交换节点之间可能会有其他的传输数据。花费了这么多的时间，换取了共享性。

一个例题：分组交换：存储-转发

A R1 R2 B

A到R1发需要5秒，接需要5秒。一个事物的两个方面，只能从一个角度来看，不能将发和接受放在一起。发和接是一个事情的两个方面，传输延迟只能算一遍。这个地方需要注意一下哈哈哈哈哈。

分组交换：排队延迟和丢失
如果到达速率大于链路的输出速率，分组将会排队，等待传输，如果路由器的缓存用完了，分组将会被抛弃。（输出队列，可能也是有限制，drop）
这都是分组交换的代价。

同样的网络资源，当计算机具有突发性的时候，显然分组交换的作用更大，按需使用。因此排队延迟和丢失，是报应和代价。任何事情都有两面性，好处：共享，坏处：排队延迟与丢失。

网络核心的关键功能：路由：决定分组采用的源到目标的路径。路由算法。路由是全局的，转发是局部的。

或许这种全局和局部的方法也可以利用在论文领域里。


分组交换，也是一种分时多路复用。不过分组交换的划分方式是随机的不是固定的。因此叫做，统计多路复用。

多路复用：频分，时分，波分，和特殊的时分，即统计多路复用。

分组交换 vs 电路交换

分组交换允许更多用户使用网络！
定量分析一下：

⚪
⚪
⚪
....                     A               B
⚪
⚪

n个用户，使用共享的A到B的链路，带宽是1Mbps
假设每个用户活跃时是  100 kbps，但是活跃的概率是0.1（即突发性）
支持数量多，即共享性越好。

采用线路交换能支持多少用户： 1Mbps / 100 Kbps = 10

采用分组交换：假设有35个用户，35个用户，35个用户有 0.4 %的可能性支持不了，可以通过一个概率求和算出来，即10个以上的设备同时活跃的话有0.4%的概率，因此支持不了。
即使有0.4%的艰难时刻，但是因为有缓存机制，排序队列，所以可以度过这0.4%。于是我们得到了结论，计算机通信在很强突发性的情况下，我们使用分组交换，使用支持的通讯设备更多一些。

同样的网络资源：拓扑一样，带宽一样的情况下，分组交换支持的资源更多。

过度使用分组交换也会出现拥塞。比如，不能出现N=35000

如何让分组交换网络，在有的时候表现得更像线路交换？后续章节会介绍。


分组交换网络：存储-转发，有下面细分的两种。
数据包的网络：源主机发送给目标主机的分组，写了目标主机的完整地址。两个主机通讯之前不需要握手，每个分组传递都是独立的。交换节点也不需要维护分组的状态。有点类似于寄信。无连接的。internet

虚电路的话，没有写明完整地址。ATM

数据包datagram。每个数据包经过一个路径时，需要匹配路由表。每个分组都独立路由，路径不一样，可能会失序。一跳一跳分组转发。目标ip没有变，但是路由表在变，所以可能路径不一样。路由器不维护主机与主机之间通信的状态。

虚电路 virtual circuit在主机与主机建立一个线路，靠信令控制信息传递。
虚电路表项。分组在这条路径上，存储转发，存储转发，这个过程中，虚电路号是可能变化的。

一个小总结：网络分类

通信网络，分为两种，两种各自进一步也可以细分为两种。





分组交换：
以分组为单位。
